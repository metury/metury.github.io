<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Year 2024 day 15 - Personal page</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Personal page</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="advent-of-code---year-2024-day-15"><a class="header" href="#advent-of-code---year-2024-day-15">Advent of code - Year 2024 Day 15</a></h1>
<p>This is a solution of the <a href="https://adventofcode.com/2024/day/15">day 15</a>. Go back to year <a href="2024.html">2024</a>. Go back to <a href="../adventofcode.html">AOC</a>.</p>
<h3 id="information"><a class="header" href="#information">Information</a></h3>
<h4 id="part-1"><a class="header" href="#part-1">Part 1</a></h4>
<p>In the first part we simulate the robot step by step. If there is <code>Space</code> move, if there is a <code>Wall</code> stop and if there is a <code>Box</code> then try to move all boxes, which is done by following the line of boxing and potentially placing the first box to the end, hence the same operation as if we moved the whole row of boxes.</p>
<p>After these procedures we compute <code>GPS</code>.</p>
<h4 id="part-2"><a class="header" href="#part-2">Part 2</a></h4>
<p>For the second part we proceed very similarly. Only change is when dealing with boxes. In a horizontal way we do the same thing, except that we do not put the box to the end, but instead move shift the row of boxes. For the vertical move we will only consider the case that we ran into a left part of the box (otherwise we switch to the left part). Then we check if both parts can be moved or not by recursion. After we check the whole sequence of boxes and get <code>true</code> answer we then may move all boxes proceeding in the same matter.</p>
<h2 id="maingo"><a class="header" href="#maingo">main.go</a></h2>
<pre><code class="language-go">package main

import (
  "fmt"
  "log"
  "os"
  "strings"
  "time"
)

const (
  Blue   = "[1;34m"
  Yellow = "[1;33m"
  Green  = "[1;32m"
  Reset  = "[0m"
)

func print_result(dur time.Duration, part, result int) {
  fmt.Println("Part " + fmt.Sprint(part) + " [" + Blue + fmt.Sprint(dur) + Reset + "]: " + Yellow + fmt.Sprint(result) + Reset)
}

const (
  Space    = 0
  Wall     = 1
  Box      = 2
  LeftBox  = 3
  RightBox = 4
)

func read_file(file_path string) ([][]int8, [2]int, [][2]int) {
  content, err := os.ReadFile(file_path)
  if err != nil {
    log.Fatal(err)
  }
  var m [][]int8
  var position [2]int
  var moves [][2]int
  for i, line := range strings.Split(string(content), "\n") {
    if len(line) == 0 {
      continue
    }
    if line[0] == '#' {
      row := make([]int8, len(line))
      for j, char := range strings.Split(line, "") {
        switch char {
        case "#":
          row[j] = Wall
        case "O":
          row[j] = Box
        case "@":
          row[j] = Space
          position = [2]int{i, j}
        case ".":
          row[j] = Space
        }
      }
      m = append(m, row)
    } else {
      for _, char := range strings.Split(line, "") {
        switch char {
        case "&gt;":
          moves = append(moves, [2]int{0, 1})
        case "&lt;":
          moves = append(moves, [2]int{0, -1})
        case "^":
          moves = append(moves, [2]int{-1, 0})
        case "v":
          moves = append(moves, [2]int{1, 0})
        }
      }
    }
  }
  return m, position, moves
}

func wider_map(m [][]int8) [][]int8 {
  wider := make([][]int8, len(m))
  for i, row := range m {
    var new_row []int8
    for j := range row {
      switch row[j] {
      case Space:
        new_row = append(new_row, Space, Space)
      case Wall:
        new_row = append(new_row, Wall, Wall)
      case Box:
        new_row = append(new_row, LeftBox, RightBox)
      }
    }
    wider[i] = new_row
  }
  return wider
}

func up_down_move(m *[][]int8, box [2]int, move [2]int) {
  if (*m)[box[0]][box[1]] == LeftBox {
    if (*m)[box[0]+move[0]][box[1]] == LeftBox || (*m)[box[0]+move[0]][box[1]] == RightBox {
      up_down_move(m, [2]int{box[0] + move[0], box[1]}, move)
    }
    if (*m)[box[0]+move[0]][box[1]+1] == LeftBox {
      up_down_move(m, [2]int{box[0] + move[0], box[1] + 1}, move)
    }
    (*m)[box[0]][box[1]] = Space
    (*m)[box[0]][box[1]+1] = Space
    (*m)[box[0]+move[0]][box[1]] = LeftBox
    (*m)[box[0]+move[0]][box[1]+1] = RightBox
  } else if (*m)[box[0]][box[1]] == RightBox {
    up_down_move(m, [2]int{box[0], box[1] - 1}, move)
  }
}

func up_down_check(m *[][]int8, box [2]int, move [2]int) bool {
  if box[0]+move[0] &lt; 0 || box[0]+move[0] &gt;= len(*m) {
    return false
  }
  plausible := true
  if (*m)[box[0]][box[1]] == LeftBox {
    if (*m)[box[0]+move[0]][box[1]] == LeftBox || (*m)[box[0]+move[0]][box[1]] == RightBox {
      plausible = plausible &amp;&amp; up_down_check(m, [2]int{box[0] + move[0], box[1]}, move)
    }
    if (*m)[box[0]+move[0]][box[1]+1] == LeftBox {
      plausible = plausible &amp;&amp; up_down_check(m, [2]int{box[0] + move[0], box[1] + 1}, move)
    }
    if (*m)[box[0]+move[0]][box[1]] == Space &amp;&amp; (*m)[box[0]+move[0]][box[1]+1] == Space {
      plausible = plausible &amp;&amp; true
    }
    if (*m)[box[0]+move[0]][box[1]] == Wall || (*m)[box[0]+move[0]][box[1]+1] == Wall {
      plausible = false
    }
  } else if (*m)[box[0]][box[1]] == RightBox {
    plausible = plausible &amp;&amp; up_down_check(m, [2]int{box[0], box[1] - 1}, move)
  }
  return plausible
}

func move_larger_box(m *[][]int8, box [2]int, move [2]int) bool {
  if move[0] == 0 {
    i := 0
    for ; box[1]+i*move[1] &lt; len((*m)[box[0]]) &amp;&amp; ((*m)[box[0]][box[1]+i*move[1]] == LeftBox || (*m)[box[0]][box[1]+i*move[1]] == RightBox); i += 1 {
    }
    if box[1]+i*move[1] &lt; len((*m)[box[0]]) &amp;&amp; (*m)[box[0]][box[1]+i*move[1]] == Space {
      (*m)[box[0]][box[1]] = Space
      (*m)[box[0]][box[1]+i*move[1]] = (*m)[box[0]][box[1]+(i-1)*move[1]]
      for j := 1; j &lt; i; j++ {
        if (*m)[box[0]][box[1]+j*move[1]] == RightBox {
          (*m)[box[0]][box[1]+j*move[1]] = LeftBox
        } else {
          (*m)[box[0]][box[1]+j*move[1]] = RightBox
        }
      }
      return true
    }
  } else {
    if up_down_check(m, box, move) {
      up_down_move(m, box, move)
      return true
    }
  }
  return false
}

func move_box(m *[][]int8, box [2]int, move [2]int) bool {
  i := 0
  for ; box[0]+i*move[0] &lt; len(*m) &amp;&amp; box[1]+i*move[1] &lt; len((*m)[box[0]]) &amp;&amp; (*m)[box[0]+i*move[0]][box[1]+i*move[1]] == Box; i++ {
  }
  if box[0]+i*move[0] &lt; len(*m) &amp;&amp; box[1]+i*move[1] &lt; len((*m)[box[0]]) &amp;&amp; (*m)[box[0]+i*move[0]][box[1]+i*move[1]] == Space {
    (*m)[box[0]][box[1]] = Space
    (*m)[box[0]+i*move[0]][box[1]+i*move[1]] = Box
    return true
  }
  return false
}

func single_step(m *[][]int8, position *[2]int, move [2]int) {
  new_position := [2]int{
    (*position)[0] + move[0],
    (*position)[1] + move[1],
  }
  switch (*m)[new_position[0]][new_position[1]] {
  case Space:
    *position = new_position
  case Wall:
    return
  case Box:
    if move_box(m, new_position, move) {
      *position = new_position
    }
  case LeftBox:
    fallthrough
  case RightBox:
    if move_larger_box(m, new_position, move) {
      *position = new_position
    }
  }
}

func simulate(m *[][]int8, position *[2]int, moves [][2]int) int {
  for _, move := range moves {
    single_step(m, position, move)
  }
  sum := 0
  for i, row := range *m {
    for j := range row {
      if row[j] == Box || row[j] == LeftBox {
        sum += i*100 + j
      }
    }
  }
  return sum
}

func part_one() {
  var result int
  start := time.Now()
  m, position, moves := read_file("INPUT")
  result = simulate(&amp;m, &amp;position, moves)
  end := time.Now()
  print_result(end.Sub(start), 1, result)
}

func part_two() {
  var result int
  start := time.Now()
  m, position, moves := read_file("INPUT")
  wider := wider_map(m)
  position[1] *= 2
  result = simulate(&amp;wider, &amp;(position), moves)
  end := time.Now()
  print_result(end.Sub(start), 2, result)
}

func main() {
  fmt.Println("Year " + Green + "2024" + Reset + " day " + Green + "15 - Claw Contraption" + Reset)
  part_one()
  part_two()
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../aoc/2024-14.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../aoc/2024-16.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../aoc/2024-14.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../aoc/2024-16.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
